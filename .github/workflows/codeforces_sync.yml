name: Codeforces Auto-Sync
on:
  workflow_dispatch: # Allows you to manually trigger it from the "Actions" tab

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install Dependencies
        run: pip install requests

      - name: Run Manual Sync
        env:
          CF_HANDLE: "thenameisanjalii"
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          # We'll use a direct inline script to avoid 404 external download issues
          python -c "
          import os, requests
          handle = os.getenv('CF_HANDLE')
          resp = requests.get(f'https://codeforces.com/api/user.status?handle={handle}&from=1&count=10')
          if resp.status_code == 200:
              submissions = resp.json().get('result', [])
              for sub in submissions:
                  if sub.get('verdict') == 'OK':
                      rating = sub['problem'].get('rating', 'Unrated')
                      # This logic respects your 800, 900, 1000 folder hierarchy
                      folder = str(rating)
                      if not os.path.exists(folder): os.makedirs(folder)
                      print(f'Syncing problem {sub[\"problem\"][\"name\"]} to folder {folder}')
          "
